(function(){$(function(){function f(){location.reload(!0)}function e(n,t){abp.message.confirm(abp.utils.formatString(abp.localization.localize("AreYouSureWantToDelete","UltimateInvocing"),t),function(t){t&&u.delete(n).done(function(){f()})})}var u=abp.services.app.order,t=$("#OrderCreateModal"),i=$("#OrderSendModal"),r=i.find("form"),n=t.find("form");n.validate({});$("#RefreshButton").click(function(){f()});$(".delete-order").click(function(){var n=$(this).attr("data-order-id"),t=$(this).attr("data-order-name");e(n,t)});$(".edit-order").click(function(n){var t=$(this).attr("data-order-id");n.preventDefault();$.ajax({url:abp.appPath+"Orders/EditOrderModal/"+t,type:"POST",success:function(n){console.log("success");$("#OrderEditModal div.modal-content").html(n)},error:function(){console.log("Failure")}})});$(".send-mail").click(function(n){var i=$(this).attr("data-order-id"),t;n.preventDefault();t=r.find("#OrderId");t.val(i)});$(".update-customer").click(function(n){var t=$(this).attr("data-order-id");n.preventDefault();$.ajax({url:abp.appPath+"Orders/UpdateCustomerDetails/"+t,type:"POST",success:function(){location.reload(!0)}})});$(".update-company").click(function(n){var t=$(this).attr("data-order-id");n.preventDefault();$.ajax({url:abp.appPath+"Orders/UpdateCompanyDetails/"+t,type:"POST",success:function(){location.reload(!0)}})});n.find("#CustomerId").on("change",function(){var i=$(this).val(),t=n.find("#AddressId");t.empty();t.selectpicker("refresh");$.ajax({url:abp.appPath+"Orders/UpdateAddresses/"+i,type:"POST",dataType:"json",success:function(n){var i,r;console.log(n);i=n.result;console.log(i);r=0;$.each(i,function(){t.append("<option value='"+i[r].id+"'>"+i[r].streetAddress+" "+i[r].houseNumber+" "+i[r].postalCode+" <\/option>");r++});t.selectpicker("refresh")},done:function(n){console.log(n)},error:function(n,t){var i="";i=n.status===0?"Not connect.\n Verify Network.":n.status==404?"Requested page not found. [404]":n.status==500?"Internal Server Error [500].":t==="parsererror"?"Requested JSON parse failed.":t==="timeout"?"Time out error.":t==="abort"?"Ajax request aborted.":"Uncaught Error.\n"+n.responseText;alert(i)}})});n.find('button[type="submit"]').click(function(i){if(i.preventDefault(),n.valid()){console.log(n);var r=n.serializeFormToObject();console.log(r);abp.ui.setBusy(t);u.create(r).done(function(n){t.modal("hide");console.log(n);window.location.pathname="Order/"+n}).always(function(){abp.ui.clearBusy(t)})}});r.find('button[type="submit"]').click(function(n){n.preventDefault();var t=r.serializeFormToObject();console.log(t);abp.ui.setBusy(i);abp.services.app.email.sendOrderEmail(t).done(function(){i.modal("hide")}).always(function(){abp.ui.clearBusy(i)})});t.on("shown.bs.modal",function(){t.find("input:not([type=hidden]):first").focus()})})})();